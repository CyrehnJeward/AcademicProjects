<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="inputFieldFunctions.js"></script>
    <link rel="stylesheet" href="stylesheet2.css" />
    <title>Page Title</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>
  <body>
    <div class="header">
      <h1>My Dashboard</h1>
    </div>

    <div class="navbar">
      <a href="CustomerLoginDashboard.html">Home</a>
      <a href="CustomerTransferFunds.html" class="active">Transfer Funds</a>
      <a href="CustomerInfo.html">About Me</a>
      <a href="LoginForm.html" class="right">Logout</a>
    </div>
    <div class="main">
      <h2>Balance</h2>
      <h2 id="balance">0.00</h2>
      <!-- <form action="TransferFunds.php" id="myForm" method="get"> -->

      <form action="OTP.html" id="myForm" method="get">
        <!-- TO DO PHP INSERT FORM -->
        <div class="container">
          <b>Transfer Funds</b>
          <div style="visibility:hidden">
          <label for="accountID"><b> Sender's Account</b></label>
          <input type="text" id="accountID" name="accountID" style ="padding: 1px 1px;
          margin: 1px 0" required />
          </div>
        
          <label for="Recepient Account"><b>Recepient Account</b></label>
          <input
            type="text"
            placeholder="Enter Recepient Account's ID number"
            name="recepient"
            id="recepient"
            required
          />

          <br />
          <br />
          <label for="amount"><b>Amount To Transfer</b></label>
          <input
            type="text"
            placeholder="Enter Amount to Transfer"
            name="amount"
            id="amount"
            onchange="check_Balance()"
            required
          />

          <br />
          <br />

          <label for="remark"><b>Remark</b></label>
          <input
            type="text"
            placeholder="Enter Remark (Optional)"
            name="remark"
            required
          />
          <br />
          <br />

          <button type="submit" class="button" name="submit" id="submit">
            Transfer
          </button>
          <!-- <button type="submit" id = "submit" onsubmit="Submited()" hidden>Register</button> -->
        </div>

        <div class="container" style="background-color: #f1f1f1">
          <h5 id = "message"> </h5>
          <button type="button" class="cancelbtn" onclick="cancelToDashboard()">
            Cancel
          </button>
        </div>
      </form>
    </div>

    <div class="footer">
      <h2>National Bank</h2>
    </div>
  </body>
</html>
<script>
  window.onload = function () {
    setIDtoSessionStorage();
    sessionStorageCheckID();
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);

    if(urlParams.has("status")){
      var userID =  urlParams.get("status");
      
      if(userID ==="notEnoughBalance"){
        message.textContent = "NOT ENOUGH FUNDS";
        // message.style.colour = "FF0000";
      }
      if(userID ==="notIDVerified"){
        message.textContent = "USER IS NOT ID VERIFIED";
        // message.style.colour = "FF0000";
      }
      if(userID ==="notEmailVerified"){
        message.textContent = "USER IS NOT EMAIL VERIFIED";
        // message.style.colour = "FF0000";
      }
      if(userID ==="TransactionComplete"){
        message.textContent = "TRANSACTION COMPLETE";
        // message.style.colour = "FF0000";
      }
      

    }
  };
 
  var userID = sessionStorage.getItem("ID");
  document.getElementById("accountID").value = userID;

  var httpRequest;
  var start = 0;
  var emailVerified;
  var IDVerified;
  //   document.getElementById("request").addEventListener("click", makeRequest);
  var httpRequest = new XMLHttpRequest();
  httpRequest.onreadystatechange = function () {
    if (httpRequest.readyState === httpRequest.DONE) {
      if (httpRequest.status === 200) {
        myObj = JSON.parse(httpRequest.responseText);
        for (var key of Object.keys(myObj)) {
          var openingBalance = document.getElementById("balance");
          
          openingBalance.textContent = "$" + myObj[key].openingBalance;
          emailVerified = myObj[key].IDVerified;
          IDVerified = myObj[key].emailVerified;

        }
        if(emailVerified===1 && IDVerified ===1){
          document.getElementById('submit').disabled = false;
          document.getElementById('submit').textContent ="Transfer"
          
        }else{
          document.getElementById('submit').disabled = true;
          document.getElementById('submit').textContent ="User must be BOTH email and ID verified to complete transaction"
        }
      } else {
        alert("Something's wrong here!");
      }
    }
    // table.setAttribute("class", "myId");
  };

  httpRequest.open(
    "get",
    "GetData3.php?Table=ViewUserAccountBalance&userID=" + userID
  );
  httpRequest.send();
  function check_Balance(){
  let balance = document.getElementById("balance").textContent;
  balance = balance.substring(1,balance.length);
  let amount = document.getElementById("amount").value
  let numBalance = parseInt(balance);
  let numAmount = parseInt(amount);
  if(numAmount > numBalance){
    document.getElementById("submit").textContent = "AMOUNT EXCEEDS BALANCE";
    document.getElementById('submit').disabled = true;
  }else{
    document.getElementById('submit').textContent ="Transfer";
    document.getElementById('submit').disabled = false;
   

  }

  
}
</script>
