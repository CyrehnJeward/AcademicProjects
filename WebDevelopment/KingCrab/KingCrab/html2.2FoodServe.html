<!DOCTYPE html>
<html lang="en">
  
  <head>
    <script src="inputFieldFunctions.js"></script>
    <link rel="stylesheet" href="stylesheet2.css" />
    <title>Page Title</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    
   
  </head>
  <body>
    <div class="header">
      <h1>Waiter</h1>
    </div>

    <div class="navbar">
      <a href="html2.0FoodOrder.html" class="hover">Food Order</a>
      <a href="html2.1FoodStatus.html" class="hover">Food Status</a>
      <a href="html2.2FoodServe.html" class="active">Food Serve</a>
      <a href="htmlLogin.html" class="right">Logout</a>


    </div>

    <div class="main"> 
      Table
      <table class="centerflex" id="table"></table>
    </div>

    <div class="footer">
      <h2>King Crab Restaurant</h2>
    </div>
  </body>
</html>
<script>
  //window.onload = function () {
    
    // const queryString = window.location.search;
    // const urlParams = new URLSearchParams(queryString);
    // var userID =  urlParams.get("ID");
    // sessionStorage.setItem("ID",userID);
  //   setIDtoSessionStorage();
  //   sessionStorageCheckID();

  // };
  // setIDtoSessionStorage();

  var WaiterID = sessionStorage.getItem("ID");
  var table = document.getElementById("table");
  var thead, tr, td;
  table.appendChild((thead = document.createElement("thead")));
  thead.appendChild((tr = document.createElement("tr")));
  tr.appendChild((td = document.createElement("td")));
  td.innerHTML = "Customer Name: ";
  tr.appendChild((td = document.createElement("td")));
  td.innerHTML = "Table Number: ";
  tr.appendChild((td = document.createElement("td")));
  td.innerHTML = "Food Status";
  tr.appendChild((td = document.createElement("td")));
  td.innerHTML = "Billing";


  var httpRequest;
  var start = 0;
  //   document.getElementById("request").addEventListener("click", makeRequest);
  var httpRequest = new XMLHttpRequest();
  httpRequest.onreadystatechange = function () {
    if (httpRequest.readyState === httpRequest.DONE) {
      if (httpRequest.status === 200) {
        //alert(httpRequest.responseText);
        var rows = document.getElementById("table").rows.length;
        var rows = document.getElementById("table").rows.length;
        
        if(rows > 2 ){
            for (let i = rows; i > 1; i--){
                document.getElementById("table").deleteRow(i-1);
            }
        }
        myObj = JSON.parse(httpRequest.responseText);
        for (var key of Object.keys(myObj)) {
          tr = document.createElement("tr");
          tr.setAttribute("id", "row" + key);
          // if (key % 2 == 0) {
          //   tr.setAttribute("style", "background:white");
          // }
          
          //#region Edit this form database
          table.appendChild(tr);
          tr.appendChild((td = document.createElement("td")));
          td.innerHTML = myObj[key].Customer;
          tr.appendChild((td = document.createElement("td")));
          td.innerHTML = myObj[key].TableNumber;
          tr.appendChild((td = document.createElement("td")));
          //td.innerHTML = myObj[key].PickupStatus;
          if (myObj[key].PickupStatus == 2){
            td.innerHTML = "Complete";
          }
          else{
            td.innerHTML = "Incomplete";
          }

          //-------------------------------------------------//
          
          tr.appendChild((td = document.createElement("td")));
          var btn = document.createElement("input");
          btn.type = "button";
          btn.className = "btn";
          btn.value = myObj[key].BillingStatus;
          
          if(myObj[key].PickupStatus != 2){
             btn.disabled = true;
          }
          
          if(myObj[key].BillingStatus == 1){
              // btn.setAttribute('disabled', '');
              btn.disabled = true;
              btn.value = "Processed for Billing";
          }
          
          if(myObj[key].BillingStatus == 0){
              // btn.setAttribute('disabled', '');
              btn.value = "Pending Status";
          }

          btn.onclick = (function (key) {
            return function () {
              updateStatus(key);
              if(myObj[key].BillingStatus == 0){
                billingStatus(key,myObj[key].CustomerQuantity,WaiterID);
              }
              document.location.reload();
            };
          })(key);
          td.appendChild(btn);

          //-------------------------------------------------//

         //#endregion Edit this form database

         
        }
        // for(var key of Object.keys(myObj[1])){
        //   document.getElementById("photoID").src = myObj[key].picturePath
        // }
      } else {
        alert("Something's wrong here!");
      }
    }
    // table.setAttribute("class", "myId");
  }

  function updateStatus(key) {
    httpRequest.open(
      "get",
      "GetTableDataCheckout.php?Table=viewCustomerOrderDetail&updateID="+key
    );
    httpRequest.send();
  }


  httpRequest.open("get", "GetTableDataCheckout.php?Table=viewCustomerOrderDetail&updateID=0");
  httpRequest.send();

  function billingStatus(key,CQ,WaiterID){
    httpRequest.open("get", "PHP2.2FoodServe.php?Table=viewFoodOrderDetail&updateID="+key+"&ED_ID="+CQ+"&FO_ID="+WaiterID);
    httpRequest.send();
  }
</script>